<div class="container-fluid mt-4">
  <div class="row mb-4">
    <!-- Sidebar with user profile -->
    <div class="col-md-3">
      <div class="card shadow">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">My Profile</h5>
        </div>
        <div class="card-body text-center" *ngIf="user">
          <div class="avatar-container mb-3">
            <div class="avatar">
              {{ user.first_name.charAt(0) }}{{ user.last_name.charAt(0) }}
            </div>
          </div>
          <h5>{{ user.first_name }} {{ user.last_name }}</h5>
          <p class="text-muted mb-2">{{ user.email }}</p>
          <p class="text-muted mb-3">{{ user.contact_number }}</p>
          <small class="d-block text-muted">{{ user.city }}, {{ user.state }}</small>
          <small class="d-block text-muted mb-3">{{ user.country }}</small>
          <hr>
          <div class="d-grid">
            <button class="btn btn-danger" (click)="logout()">Logout</button>
          </div>
        </div>
      </div>

      <!-- Quick links -->
      <div class="card shadow mt-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Quick Links</h5>
        </div>
        <div class="card-body p-0">
          <div class="list-group list-group-flush">
            <a [routerLink]="['/user', user?.id, 'vehicles']" class="list-group-item list-group-item-action">
              <i class="bi bi-car-front me-2"></i> My Vehicles
            </a>
            <a href="javascript:void(0)" class="list-group-item list-group-item-action">
              <i class="bi bi-ticket-perforated me-2"></i> My Bookings
            </a>
            <a class="list-group-item list-group-item-action" href="/parking-locations">
              <i class="bi bi-geo-alt me-2"></i> Find Parking
            </a>
            <a href="javascript:void(0)" class="list-group-item list-group-item-action">
              <i class="bi bi-credit-card me-2"></i> Payment History
            </a>
            <a href="javascript:void(0)" class="list-group-item list-group-item-action">
              <i class="bi bi-gear me-2"></i> Settings
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Main content area -->
    <div class="col-md-9">
      <!-- Welcome message and date -->
      <div class="mb-4">
        <h2 class="mb-1">Welcome, {{ user?.first_name || 'User' }}!</h2>
        <p class="text-muted">{{ currentDate | date: 'fullDate' }}</p>
      </div>

      <!-- Stats summary cards -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card bg-primary text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="mb-0">Active Bookings</h6>
                  <h3 class="mt-2 mb-0">{{ bookings.active }}</h3>
                </div>
                <div class="display-4">
                  <i class="bi bi-clock"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-info text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="mb-0">Upcoming</h6>
                  <h3 class="mt-2 mb-0">{{ bookings.upcoming }}</h3>
                </div>
                <div class="display-4">
                  <i class="bi bi-calendar-check"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-success text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="mb-0">Completed</h6>
                  <h3 class="mt-2 mb-0">{{ bookings.completed }}</h3>
                </div>
                <div class="display-4">
                  <i class="bi bi-check-circle"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-secondary text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="mb-0">My Vehicles</h6>
                  <h3 class="mt-2 mb-0">{{ vehicles.length }}</h3>
                </div>
                <div class="display-4">
                  <i class="bi bi-car-front"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main tab content -->
      <div class="card shadow">
        <div class="card-header">
          <ul ngbNav #nav="ngbNav" [(activeId)]="activeTab" class="nav-tabs">
            <li [ngbNavItem]="1">
              <a ngbNavLink>Recent Bookings</a>
              <ng-template ngbNavContent>
                <div *ngIf="isLoading" class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
                <div *ngIf="!isLoading">
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>ID</th>
                          <th>Location</th>
                          <th>Vehicle</th>
                          <th>Entry Time</th>
                          <th>Exit Time</th>
                          <th>Status</th>
                          <th>Amount</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let booking of recentBookings">
                          <td>#{{ booking.id }}</td>
                          <td>{{ booking.location }}</td>
                          <td>{{ booking.vehicle }}</td>
                          <td>{{ formatDate(booking.entry_time) }}</td>
                          <td>{{ booking.exit_time ? formatDate(booking.exit_time) : '-' }}</td>
                          <td>
                            <span class="badge rounded-pill {{ getStatusClass(booking.status) }}">
                              {{ booking.status | titlecase }}
                            </span>
                          </td>
                          <td>â‚¹{{ booking.amount }}</td>
                          <td>
                            <button class="btn btn-sm btn-outline-primary me-1">View</button>
                            <button *ngIf="booking.status === 'upcoming'" class="btn btn-sm btn-outline-danger">Cancel</button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="text-center mt-3">
                    <button class="btn btn-outline-primary">View All Bookings</button>
                  </div>
                </div>
              </ng-template>
            </li>
            <li [ngbNavItem]="2">
              <a ngbNavLink>My Vehicles</a>
              <ng-template ngbNavContent>
                <div *ngIf="isLoading" class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
                <div *ngIf="!isLoading" class="pb-3">
                  <div class="row my-3">
                    <div class="col-md-12 text-end">
                      <button class="btn btn-primary">
                        <i class="bi bi-plus"></i> Add New Vehicle
                      </button>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-4 mb-4" *ngFor="let vehicle of vehicles">
                      <div class="card h-100">
                        <div class="card-header bg-light">
                          <h5 class="mb-0">{{ vehicle.brand }} {{ vehicle.model }}</h5>
                        </div>
                        <div class="card-body">
                          <div class="vehicle-icon text-center mb-3">
                            <i class="bi bi-car-front display-1 text-primary"></i>
                          </div>
                          <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between">
                              <strong>Number Plate:</strong> <span>{{ vehicle.number_plate }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                              <strong>Type:</strong> <span>{{ vehicle.type }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                              <strong>Color:</strong> <span>{{ vehicle.color }}</span>
                            </li>
                          </ul>
                        </div>
                        <div class="card-footer d-flex justify-content-between">
                          <button class="btn btn-sm btn-outline-primary">Edit</button>
                          <button class="btn btn-sm btn-outline-danger">Delete</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-template>
            </li>
            <li [ngbNavItem]="3">
              <a ngbNavLink>Find Parking</a>
              <ng-template ngbNavContent>
                <div class="py-4">
                  <div class="row justify-content-center">
                    <div class="col-md-10">
                      <h4 class="mb-4 text-center">Search Available Parking Locations</h4>
                      <div class="card mb-4">
                        <div class="card-body">
                          <p class="text-center mb-4">
                            Use our interactive map and advanced search features to find and book parking spaces near your destination.
                          </p>
                          <div class="d-grid gap-2 col-md-6 mx-auto">
                            <a class="btn btn-primary btn-lg" href="/parking-locations">
                              <i class="bi bi-search me-2"></i> Find Parking
                            </a>
                          </div>
                        </div>
                      </div>
                      <div class="text-center mt-5">
                        <img src="assets/images/map-placeholder.svg" alt="Map placeholder" class="img-fluid rounded">
                        <p class="text-muted mt-3">Find the best parking spots at the best prices</p>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-template>
            </li>
          </ul>
        </div>
        <div class="card-body">
          <div [ngbNavOutlet]="nav"></div>
        </div>
      </div>
    </div>
  </div>
</div> 